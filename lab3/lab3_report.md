University: [ITMO University](https://itmo.ru/ru/) \
Faculty: [FICT](https://fict.itmo.ru) \
Course: [Introduction to distributed technologies](https://github.com/itmo-ict-faculty/introduction-to-distributed-technologies) \
Year: 2024/2025 \
Group: k4111c \
Author: Sagaydak Alina Alekseevna \
Lab: Lab3 \
Date of create: 26.11.2024 \
Date of finished: ...
## –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ3 "–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ "—Å–µ–∫—Ä–µ—Ç—ã" –≤ Minikube, –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö."

### –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

–ü–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ –∏ "—Å–µ–∫—Ä–µ—Ç–∞–º–∏" –≤ Minikube, –ø—Ä–∞–≤–∏–ª–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ Minikube.

### –•–æ–¥ —Ä–∞–±–æ—Ç—ã

1) –°–æ–∑–¥–∞—Ç—å ConfigMap —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å—Ä–µ–¥—ã REACT_APP_USERNAME –∏ REACT_APP_COMPANY_NAME; 
2) –°–æ–∑–¥–∞—Ç—å ReplicaSet —Å 2 —Ä–µ–ø–ª–∏–∫–∞–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ifilyaninitmo/itdt-contained-frontend:master; 
3) –í–∫–ª—é—á–∏—Ç—å Ingress –∏ —Å–æ–∑–¥–∞—Ç—å TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç; 
4) –°–æ–∑–¥–∞—Ç—å Ingress, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å –∏ —Å–µ–∫—Ä–µ—Ç —Å TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º; 
5) –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HOSTS; 
6) –û—Ç–∫—Ä—ã—Ç—å minikube tunnel;
7) –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
#### 1. –°–æ–∑–¥–∞–Ω–∏–µ ConfigMap
–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–∏—Å–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª ConfigMap.

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ConfigMap –±—ã–ª —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª-–º–∞–Ω–∏—Ñ–µ—Å—Ç [configmap.yaml](configmap.yaml), –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –Ω–∏–∂–µ:
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: lab3-configmap
data:
  REACT_APP_USERNAME: "asagaydak"
  REACT_APP_COMPANY_NAME: "asagaydak-pizza-software"
```
C–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç ConfigMap –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–æ–º–∞–Ω–¥—ã:

```bash
asagaydak@alinas-air lab3 % minikube kubectl -- apply -f configmap.yaml
configmap/lab3-configmap created
```
#### 2. –°–æ–∑–¥–∞–Ω–∏–µ ReplicaSet
ReplicaSet ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç –≤ Kubernetes, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö –∫–æ–ø–∏–π –ø–æ–¥–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ. 
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ—Å—Ç–∏—á—å –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. ReplicaSet —Å–ª–µ–¥–∏—Ç –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–æ–¥–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∏–ª–∏ —É–¥–∞–ª—è–µ—Ç –∏—Ö –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç—Ä–µ–±—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π.

–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–∏—Å–∞—Ç—å manifest ReplicaSet [deployment.yaml](deployment.yaml).
```yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: lab3-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: lab3-deployment
  template:
    metadata:
      labels:
        app: lab3-deployment
    spec:
      containers:
        - name: frontend
          image: ifilyaninitmo/itdt-contained-frontend:master
          ports:
            - containerPort: 3000
          envFrom:
            - configMapRef:
                name: lab3-configmap
```
C–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç ReplicaSet –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–æ–º–∞–Ω–¥—ã:

```bash
asagaydak@alinas-air lab3 % minikube kubectl -- apply -f deployment.yaml
replicaset.apps/lab3-deployment created
```
#### 3. –í–∫–ª—é—á–µ–Ω–∏–µ Ingress –∏ —Å–æ–∑–¥–∞–Ω–∏–µ TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
Ingress - —ç—Ç–æ –æ–±—ä–µ–∫—Ç Kubernetes, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤–Ω–µ—à–Ω–∏–º –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å–µ—Ä–≤–∏—Å–∞–º –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å HTTP(S)-–∑–∞–ø—Ä–æ—Å—ã –∫ –Ω—É–∂–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, URL –∏–ª–∏ —Ö–æ—Å—Ç-–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
–£ –Ω–µ–≥–æ –µ—Å—Ç—å 3 –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –∫ –∫–∞–∫–∏–º —Å–µ—Ä–≤–∏—Å–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–º–µ–Ω–æ–≤ –∏–ª–∏ –ø—É—Ç–µ–π;
- –û–±—Ä–∞–±–æ—Ç–∫–∞ SSL/TLS. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫;
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏. –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –º–µ–∂–¥—É —Ä–µ–ø–ª–∏–∫–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è Ingress –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞:

–¢–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∏–º Ingress —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã:
```bash
asagaydak@alinas-air lab3 % minikube addons enable ingress
üí°  ingress is an addon maintained by Kubernetes. For any concerns contact minikube on GitHub.
You can view the list of minikube maintainers at: https://github.com/kubernetes/minikube/blob/master/OWNERS
üí°  After the addon is enabled, please run "minikube tunnel" and your ingress resources would be available at "127.0.0.1"
    ‚ñ™ Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.4.3
    ‚ñ™ Using image registry.k8s.io/ingress-nginx/controller:v1.11.2
    ‚ñ™ Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.4.3
üîé  Verifying ingress addon...
üåü  The 'ingress' addon is enabled
```
–î–∞–ª–µ–µ —Å–æ–∑–¥–∞–¥–∏–º TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç. 
```bash
asagaydak@alinas-air lab3 % openssl req -new -newkey rsa:4096 -x509 -sha256 -days 365 -nodes -out MyCertificate.crt -keyout MyKey.key -subj "/CN=asagaydak-pizza-software.com"
.....+.....+.......+.........+.....................+.........+..+.........+...+.......+...+..+.+...+..+..........+..+++++++++++++++++++++++++++++++++++++++++++++*..+.+..............+.+...+...+.........+........+.+...........+.+..+...+.......+...+...+..+...............+.......+..+...+.+++++++++++++++++++++++++++++++++++++++++++++*.........+.......+...............+............+...............+...............+....................+......+....+...+..................+..+.......+..+...+............+......+............+.+...........+...+.......+++++
............+....+......+......+............+.....................+..+..........+..+.+.........+..+...+.......+...+...........+.+...+............+......+...+..+....+.....+...+..........+..+++++++++++++++++++++++++++++++++++++++++++++*.............+.........+..+++++++++++++++++++++++++++++++++++++++++++++*...+.+.........+......+...............+..+................+..+.......+..+.+...+.........+.....+.+.....+...................+...+...+.....................+.....+.+..+.......+...+......+...........+.+..+...+....+...+.....+.......+...........+....+......+...+..........................+.........+.....................+..........+........+.+....................+.+.....+....+......+.....+.+..+...+............+...+..........+...............+............+..+......+.......+...+............+...+..+.............+..+...............+...+....+......+...+..+............+.+...........+......+............+......+.+...+...+...+.....+......+.+............+..+.+.....+.........................+..+.......+...+...........+.......+.....+.........+.+...+.....+......+..........+.....+...............+......+...+....+........+............+.+.....+..............................+......+.+........+....+..+..........+.....+..................+.+.........+.....+...+...+.......+..+.+..+...................+..............+...............+.+...+.................+...+..........+..+...+..........+...+.....+..........+.........+.....+....+......+...+.....+......+....+..+......+...+................+........+.......+......+.....+..........+..............+....+.........+...........+.+..............+......+...+.+..+....+.....+......+.............+..+............+............+.............+................................+....+.................+..........+..............+.+..+......+.+......+.........+...+...........+....+........+............+...+..................+.+......+..+.......+..............+.+.....+......+....+........+...........................+.+....................+............+......+........................+...+....+.....+.+.....+.......+........+.......+.....+.+...........+....+.....+.........+......+................+........+......+......+...+...+....+..................+........+....+.....+....+.....+............+...+....+......+............+...+..+....+.....+......+.............+..+.......+...............+..+................+.....+....+......+........+..........+.....+.+...+...+.....+.......+..+.+........+.......+..+.......+...........+...+...............+......+.+..............+..................+......+......................+.........+.....+....+...............+.....+......................+..+.+..+....+..................+..+.............+......+.........+......+....................+.......+..............+....+......+...+..+...+......+....+........+..........+..+...+.......+......+..+...+.......+.........+...+..+.+..............+.........+.......+..................+...........+...............+...+..........+.....+.+.....+....+..................+..+...............+.............+..................+..+.........................+...+...........+....+.....+.........+...+...............+..................+....+..+++++
```
–ü–æ–ª—É—á–∏–ª—Å—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç MyCertificate.crt –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –µ–º—É –∑–∞–∫—Ä—ã—Ç—ã–π –∫–ª—é—á MyKey.key, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –¥–æ–º–µ–Ω—É asagaydak-pizza-software.com.

–¢–µ–ø–µ—Ä—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ minikube, –∫–∞–∫ –æ–±—ä–µ–∫—Ç secret, —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã:
```bash
asagaydak@alinas-air lab3 % minikube kubectl -- create secret tls app-tls --key MyKey.key --cert MyCertificate.crt
secret/app-tls created
```

#### 4. –°–æ–∑–¥–∞–Ω–∏–µ Ingress
–î–∞–ª–µ–µ —Å–æ–∑–¥–∞–¥–∏–º –æ–±—ä–µ–∫—Ç Ingress, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Å–µ–∫—Ä–µ—Ç —Å TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º.

–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–∏—Å–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ [ingress.yaml](ingress.yaml).
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lab3-ingress
spec:
  tls:
    - hosts:
        - asagaydak-pizza-software.com
      secretName: app-tls
  rules:
    - host: asagaydak-pizza-software.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: lab3-service
                port:
                  number: 3000
```
–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–æ–º–∞–Ω–¥—ã:
```bash
asagaydak@alinas-air lab3 % minikube kubectl -- expose replicaset lab3-deployment --port=3000 --name=lab3-service --type=ClusterIP
service/lab3-service exposed
```
–¢–∏–ø —Å–µ—Ä–≤–∏—Å–∞ —É–∫–∞–∑–∞–Ω `ClusterIP`, –¥–∞–Ω–Ω—ã–π —Ç–∏–ø –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Å–∞–º–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞.

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–º–µ–ª–æ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç Ingress –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–æ–º–∞–Ω–¥—ã:
```bash
asagaydak@alinas-air lab3 % minikube kubectl -- apply -f ingress.yaml
ingress.networking.k8s.io/lab3-ingress created
```

#### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HOSTS
–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å hosts, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∑–Ω–∞—Ç—å IP-–∞–¥—Ä–µ—Å, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç minikube:
```bash
asagaydak@alinas-air lab3 % minikube ip
192.168.49.2
```
–¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ —Ñ–∞–π–ª /etc/hosts:
```bash
127.0.0.1       localhost
192.168.49.2    asagaydak-pizza-software
```
#### 6. –û—Ç–∫—Ä—ã—Ç—å minikube tunnel
–í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –∫–æ–º–∞–Ω–¥–æ–π `minikube tunnel`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª–∏—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º –≤–Ω—É—Ç—Ä–∏ Minikube. 

–≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏, —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã–º–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ Minikube, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –≤–Ω–µ—à–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞ –¥–ª—è –Ω–∏—Ö.
```bash
asagaydak@alinas-air lab3 % minikube tunnel
‚úÖ  Tunnel successfully started

üìå  NOTE: Please do not close this terminal as this process must stay alive for the tunnel to be accessible ...

‚ùó  The service/ingress lab3-ingress requires privileged ports to be exposed: [80 443]
üîë  sudo permission will be asked for it.
üèÉ  Starting tunnel for service lab3-ingress.
Password:
```
#### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –∞–¥—Ä–µ—Å—É `asagaydak-pizza-software` –æ—Ç–æ–±—Ä–∞–∂–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:

![image](./images/result.png)

#### –î–∏–∞–≥—Ä–∞–º–º–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

![image](./images/diagramm.png)